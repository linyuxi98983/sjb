var $_GET = function() {
    var a = window.document.location.href.toString().split("?");
    if ("string" == typeof a[1]) { - 1 != a[1].indexOf("#") ? (a = a[1].split("#"), a = a[0].split("&")) : a = a[1].split("&");
        var f = {},
        e;
        for (e in a) {
            var d = a[e].split("=");
            f[d[0]] = d[1]
        }
        return f
    }
    return {}
} ();
String.prototype.strip_tags = function(a) {
    a = a ? a.toLowerCase() : "";
    return this.replace(/<[\/\!\?]?([\w_-]*)[^>]*>/igm,
    function(f, e) {
        return - 1 < a.indexOf("<" + e.toLowerCase() + ">") ? f: ""
    })
};
String.prototype.replaceAll = function(a, f, e) {
    return RegExp.prototype.isPrototypeOf(a) ? this.replace(a, f) : this.replace(RegExp(a, e ? "gi": "g"), f)
};
//�ղ�
var m_collect = {
    clearwishfail: "",
    mdd_token: "",
    search_login_url: "",
    wishfail: function(a) {
        $("#customer_load").html(a);
        $("#customer_load").parent().fadeIn();
        this.clearwishfail = window.setTimeout("$('#customer_load').parent().fadeOut('fast');", 1E3);
        return ! 1
    },
    addwishlist: function(a, f) {
        var e = location.href,
        d = $("#search_" + a),
        c = d.attr("flag"),
        b = "add" == c ? "\u6536\u85cf\u5931\u8d25": "\u53d6\u6d88\u6536\u85cf\u5931\u8d25",
        h = this;
        clearTimeout(h.clearwishfail);
        $.ajax({
            type: "POST",
            url: searchUrl + "search_wishlist.php",
            data: {
                product_id: f,
                dotype: c,
                burl: e
            },
            timeout: 5E3,
            dataType: "json",
            success: function(a) {
                0 == a.errorCode ? (d.toggleClass("span_sc_on"), d.attr("flag", "add" == c ? "del": "add"), $("#customer_load").parent().fadeOut("fast")) : 96 == a.errorCode ? location.assign(h.search_login_url) : h.wishfail(a.errorMsg)
            },
            error: function(a, c, d) {
                h.wishfail(b)
            }
        })
    },
    checkLogin: function() {
        var a = this.search_login_url;
        return "" == this.mdd_token ? (location.assign(a), !1) : !0
    },
    searchWishlist: function(a, f,goodsId) {
    	$.ajax({
			url: base +"/mobile/login/login.action",
			type: "POST",
			data:{
				"result":"json"
			},
			dataType: "json",
			cache: false,
			success: function(message) {
				if(message.success == true || message.success == 'true'){
					$.ajax({
			             type: "GET",
			             url: base+"/mobile/member/favorite!save.action",
			             dataType: "json",
			             data:{
			             	"entity.objectId":goodsId,
			             	"entity.keepKind":0
			             },
			             success: function(c) {
			            	 if(c.success){}else{
			            		 showError(c.msg);
			             	}
			             },
			             error: function(a, b, d) {
			                
			             }
			         });											
				}else{
					window.location = base+"/mobile/login/login.action?currentUrl=" + window.location.href;
				}
			}
		});
    	 
    	/*if(this.checkLogin() && "none" == $("#customer_load").parent().css("display")) {
            var e = "add" == $("#search_" + a).attr("flag") ? "\u6536\u85cf\u4e2d...": "\u53d6\u6d88\u6536\u85cf\u4e2d ...";
            $("#customer_load").html(e).parent().fadeIn("fast");
            this.addwishlist(a, f)
        }    */   
    }
};
//���ظ��
$("#curr_page").val(1);

var m_loadMore = {
	result:"sub_single",
    p: "",
    loading: !1,
    loadC: 0,
    big_pic_class: "",
    pageSize: 10,
    hasNext: !0,
    type: 0,
    page: 2,
    brand:null,
    param:{
    	click:"NO",
    	single:"YES",
    	orderby:'',
    	orderdesc:''
    },
    init: function() {
        this.loading = !1;
        this.loadC = 0;
        this.page = 2;
        this.extendFun();
        this.be()
        setTimeout(this.loadrefrash,300) ; 
    },
    loadrefrash:function(){
    
    	var pageCount = parseInt($("#total_page").val());
    	
    	if(pageCount < 10){
        	$(".load").hide();
        }
    	
    	
    },
    extendFun: function() {},
    be: function() {
        this.scrollAutoLoad()
    },
    loadMore: function() {
    
    	this.loading = !0;
    	var a = parseInt($("#curr_page").val()) + 1; //��ǰ���ص�ҳ��
    	this.page = a;
    	var d = this;
    	this.loading = !0;
    	//var a = parseInt($("#curr_page").val()) + 1; //��ǰ���ص�ҳ��
    	
    	var pageCount = parseInt($("#total_page").val());
    	
    	//alert($("#total_page").val())
    	//this.page = a;
    	var d = this;
    	//��Ⱦ��ݿ�ʼ
    	var page = Math.ceil(pageCount/this.pageSize);
    	
    	var single;
    	if($("#goods_list_type").hasClass("goods_list_two")){
    		this.result = "sub_single";
    	}else if($("#goods_list_type").hasClass("goods_list_single")){
    		this.result = "sub_list";
    	}
   
    	//alert(a + " --- " + page)
    	var type = this.type;
    	if(a >1 && a <= page){
    		
    		$.ajax({
                type: "GET",
                url: searchUrl + "goods!list.action",
                dataType: "html",
                data:{
                	'pageNumber':a,
                	"result":this.result,
                	"type":queryUrlParam("type"),
                	"orderby":type,
                	"mhomeId ":queryUrlParam("mhomeId"),
                	"proId ":queryUrlParam("proId"),
                	"ticketId ":queryUrlParam("ticketId")
                },
                success: function(c) {
                	$(".goods_list .clearfix ul").append(c);
                	//��Ⱦ��ݽ���
                	d.loading = !1;
                	//�ӳټ���ͼƬ
                	$("img.img_lazy_xf").lazyload();
                	$("#curr_page").val(a);
                	$(".load").hide();
                	$("#total_page").remove();
                	
                },
                error: function(a, b, d) {
                    console.log(d)
                }
            });
    	}else{
    		$(".load").hide()
    	}
    	$(".nodata_css").remove();
    	if(pageCount == 0){
    		$(".goods_list").append("<div class='nodata_css' stype='text-align: center'>无数据</div>");
    		$(".goods_list").css("text-align","center");
    	}else{
    		$(".nodata_css").remove();
    	}
    },
    scrollAutoLoad: function() {//�жϹ�����λ��
    	
        var a = this;
        $(function() {
            var f = $(window).height();
            $(window).scroll(function() {
                var e = $(".load"),
                d = $("._pre").css("display");
                if (0 < e.length && "none" !== d) {
                    var d = parseInt(e.height()),
                    e = e.offset().top,
                    c = d + e,
                    d = $(window).scrollTop() + f,
                    c = d - c; (100 > Math.abs(c) || 0 <= c || d >= e) && !a.loading && a.loadMore()
                }
            })
        })
    },
    
    reloadData:function(data){
    	
    	$.ajax({
            type: "GET",
            url: searchUrl + "goods!list.action",
            dataType: "html",
            data:data,
            success: function(c) {
            	//$(".goods_list .clearfix ul li").remove();
            	$(".goods_list .clearfix ul").html(c);
            	//��Ⱦ��ݽ���
            	//d.loading = !1;
            	//�ӳټ���ͼƬ
            	$("img.img_lazy_xf").lazyload();
            	$(".load").hide();
            	$("#curr_page").val(1)
            	
            	m_loadMore.loadMore();            	
            },
            error: function(a, b, d) {
                console.log(d)
            }
        });    	
    	
    }
};